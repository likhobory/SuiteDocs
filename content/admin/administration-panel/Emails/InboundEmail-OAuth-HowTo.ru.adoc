---
Title: Настройка E-mail с использованием OAuth
weight: 36
---

:author: likhobory
:email: likhobory@mail.ru

:toc:
:toc-title: Оглавление

:experimental:

:imagesdir: /images/ru/admin/Email/InboundEmail-OAuth

ifdef::env-github[:imagesdir: ../../../../static/images/ru/admin/Email/InboundEmail-OAuth]

:btn: btn:

ifdef::env-github[:btn:]

:en-img: ../../../../../images/en/admin/email/microsoft/

ifdef::env-github[:en-img: ./../../../../../../static/images/en/admin/email/microsoft/]

//
:sectnums:
:sectnumlevels: 2
//

== Введение

В этом разделе описывается настройка входящей и исходящей электронной почты при помощи предварительно настроенного провайдера OAuth.

{{% notice note %}}
В качестве примера мы будем использовать учетную запись Microsoft, однако, описываемые здесь действия должны быть аналогичны и для других провайдеров.
{{% /notice %}}

Мы будем настраивать персональную учётную запись при помощи группового провайдера OAuth. Групповые провайдеры OAuth предназначены для использования  несколькими пользователями SuiteCRM.

В качестве администраторы системы вам доступно создание трёх видов  учётных записей:

 * Персональные
 ** Доступны только создавшим их пользователям
 ** Предназначены для настройки доступа к личным учётным записям,  например, *_john.doe@example-inc.onmicrosoft.com_*.
 ** Настройка этих учетных записей доступна только владельцу учётной записи и администраторам системы.
 * Групповые
 ** Могут быть использованы несколькими пользователями
 ** Предназначены для использования учётными записями в домене, который используют несколько пользователей, например, все члены группы технической поддержки будут иметь доступ к *_support@example-inc.onmicrosoft.com_*.
 * Для обработки link:../email#_типы_учётных_записей[возвращаемой почты]
 ** Предназначены только для чтения входящей почты, возвращаемой в рамках проводимых link:../../../../user/core-modules/campaigns[маркетинговых кампаний]
 
{{% notice warning %}}
Убедитесь, что в настроенных учётных записях используется соответствующий тип провайдера OAuth. Например, используйте группового провайдера OAuth для настройки групповой учётной записи.
{{% /notice %}}

{{% notice note %}}
Если вы ещё не настроили провайдера OAuth или не знаете, как это сделать, прочтите раздел 
link:../microsoft-oauth-provider-howto[Настройка провайдера Microsoft OAuth].
{{% /notice %}}


== Создание подключения OAuth 

 . Откройте страницу настроек 
 link:../../../../user/introduction/managing-user-accounts[параметров пользователя], в меню модуля выберите пункт *Внешние подключения OAuth* и затем *Создать персональное подключение OAuth*.

image:image1.png[Создать персональное подключение OAuth]

[start=2]
 . Добавьте значимое название для создаваемого подключения, это может быть просто имя пользователя или что-то, что поможет вам идентифицировать и отличить запись от других подключений.

 . Выберите созданного ранее провайдера Microsoft и нажмите на кнопку {btn}[Аутентификация], после чего должно появиться всплывающее окно аутентификации.

image:{en-img}microsoft-authenticate-popup.png[microsoft-authenticate-popup.png]

[start=4]
 . После прохождения процедуры аутентификации всплывающее окно будет закрыто, а оставшиеся поля  заполнятся соответствующими значениями.

{{% notice warning %}}
Не делитесь ни с кем значениями токенов. Это конфиденциальная информация!
{{% /notice %}}

[start=5]
 . Нажмите на кнопку {btn}[Сохранить].

== Настройка почтовой учётной записи 

=== Настройка учётной записи входящей почты

 . Откройте страницу настроек 
 link:../../../../user/introduction/managing-user-accounts[параметров пользователя], в меню модуля выберите пункт *Учётные записи входящей почты*, а затем - *Создать персональную учётную запись входящей почты*.

image:image2.png[Создать персональную учётную запись входящей почты]

[start=2]
 . Заполните следующие поля

Название:: Добавьте значимое название для создаваемой учётной записи, это может быть просто имя пользователя или что-то, что поможет вам идентифицировать и отличить запись от других учётных записей.

Владелец:: Выберите имя владельца учётной записи. Поле доступно только администратору системы.

Аутентификация:: Выберите *OAuth*  и в поле *Внешнее подключение OAuth* выберите ранее созданного провайдера.


{{% notice warning %}}
Для групповой учётной записи входящей почты должно быть выбрано *групповое внешнее подключение OAuth*, при выборе персонального подключения OAuth может возникнуть ошибка.
{{% /notice %}}

{{% notice note %}}
В качестве примера  будут указаны настройки, актуальные для учётной записи Microsoft.
{{% /notice %}}

Сервер входящей почты:: Введите адрес сервера входящей почты, например - *outlook.office365.com*.
Протокол:: Из выпадающего списка выберите *IMAP*.
Порт почтового сервера:: Введите порт почтового сервера, например - 993.
Использовать SSL:: Отметьте данный параметр при использовании протокола Secure Socket Layer (SSL) при подключении к почтовому серверу.
Строка подключения:: Введите строку подключения, если для соединения с сервером требуются особые параметры.
Тип поиска в тексте Email:: Выберите тип поиска - по одному или по нескольким словам.
Логин:: Укажите логин созданного ранее подключения OAuth, например - *_example@\example@onmicrosoft.com_*
Пароль:: Введите пароль пользователя.

{{% notice note %}}
Перечисленные ниже папки будут доступны для выбора только после настройки всех предыдущих параметров.
{{% /notice %}}

Проверяемые папки:: Укажите название папки для входящей почты.
Удалённые:: Укажите название папки для удалённой почты.
Отправленные:: Укажите название папки для отправленной почты.

[start=3]
 .	В подразделе *Настройки исходящей почты* заполните следующие поля:

image:image3.png[Настройки исходящей почты]


Выбор учётной записи исходящей почты:: Укажите сервер исходящей почты, который будет использоваться при ответе на входящее письмо. Если сервер не указан, то будет использован сервер исходящей почты, настроенный по умолчанию.
Подпись:: Выберите подпись в письме или создайте её, как это описано в разделе 
link:../../../../user/core-modules/emails/#_основные_настройки[Основные настройки].
Имя отправителя:: Укажите, от чьего имени будет отправляться письмо.
Адрес отправителя:: Укажите, с чего адреса будет отправляться письмо.
Ответить на имя:: Введите имя получателя возвращаемых писем.
Ответить на адрес:: Введите адрес получателя возвращаемых писем.

[start=4]
 . Нажмите на кнопку {btn}[Сохранить].
 
=== Настройка учётной записи исходящей почты

 . Откройте страницу настроек 
 link:../../../../user/introduction/managing-user-accounts[параметров пользователя], в меню модуля выберите пункт *Учётные записи исходящей почты*, а затем - *Создать персональную учётную запись исходящей почты*.
 
image:image7.png[Создать персональную учётную запись исходящей почты]
 
[start=2]
 . Заполните следующие поля

Название:: Добавьте значимое название для создаваемой учётной записи, это может быть просто имя пользователя или что-то, что поможет вам идентифицировать и отличить запись от других учётных записей.

Владелец:: Выберите имя владельца учётной записи. Поле доступно только администратору системы.

Аутентификация:: 
Существует три различных типа аутентификации:
Не используется:::
Это тип установлен по умолчанию, предназначен для использования на сервере, не требующем аутентификации, например, на локальном SMTP-сервере.
Базовая аутентификация:::
Этот тип используется на сервере, требующем базовой аутентификации, например, на локальном SMTP-сервере или сервере, не поддерживающем OAuth.
OAuth:::
Этот тип используется на сервере, поддерживающем аутентификацию OAuth, например, для учётных записей Microsoft или Google. + 
Выберите *OAuth*  и в поле *Внешнее подключение OAuth* выберите ранее созданного провайдера.

{{% notice warning %}}
Для групповой учётной записи входящей почты должно быть выбрано *групповое внешнее подключение OAuth*, при выборе персонального подключения OAuth может возникнуть ошибка.
{{% /notice %}}

Логин:: Укажите тот же логин, что использовался при создании соответствующего подключения OAuth.

Сервер исходящей почты:: Укажите адрес сервера исходящей почты. Например, для Microsoft укажите `smtp-mail.outlook.com`.

Параметры SMTP/SSL:: В зависимости от настроек сервера включите необходимый протокол.

Порт:: Введите порт почтового сервера, например - 25.

Имя отправителя:: Укажите, от чьего имени будет отправляться письмо.

Адрес отправителя:: Укажите, с чего адреса будет отправляться письмо.

Ответить на имя:: Введите имя получателя возвращаемых писем.

Ответить на адрес:: Введите адрес получателя возвращаемых писем.

[start=3]
 . Нажмите на кнопку {btn}[Сохранить].

== Настройка отображения входящей почты в модуле E-mail

Поскольку для пользователя может быть настроено несколько учётных записей входящей почты, необходимо выбрать учётные записи, письма из которых будут отображаться в модуле *E-mail*.

 . Откройте страницу настроек 
 link:../../../../user/introduction/managing-user-accounts[параметров пользователя], в нижней части страницы перейдите к подразделу *Настройка E-mail* и нажмите на кнопку кнопку {btn}[Настройка параметров электронной почты].

image:image4.png[Настройка параметров электронной почты]
 
[start=2]
 . Выберите необходимые учётные записи (папки), как это описано в разделе 
 link:../../../../user/core-modules/emails/#_основные_настройки[Основные настройки] и нажмите на кнопку {btn}[Готово].
  
 . Нажмите на кнопку {btn}[Сохранить].


== Смена учётной записи входящей почты в модуле E-mail

В правом верхнем углу модуля 
link:../../../../user/core-modules/emails[E-mail] отображается кнопка смены учётной записи.

image:image5.png[Смена учётной записи входящей почты в модуле E-mail]

Нажмите на неё и в открывшемся списке выберите необходимую учётную запись.

image:image6.png[Выбор учётной записи входящей почты в модуле E-mail]

Более детально элементы интерфейса почтового модуля рассматриваются в разделе
link:../../../../user/core-modules/emails/#_описание_элементов_интерфейса[Описание элементов интерфейса].
